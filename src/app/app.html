<main class="main">
  <div class="container">
    <header class="header">
      <h1 class="title">{{ title() }}</h1>
      <p class="subtitle">Calculate how much salary is earned during idle time.</p>
    </header>

    @if (!setupComplete()) {
      <section class="grid single">
        <div class="card form-card">
          <h2 class="card-title">Setup</h2>
          <div class="form-group">
            <label class="label" for="salary">Monthly salary</label>
            <div class="input-group">
              <span class="prefix">RM</span>
              <input id="salary" class="input" type="number" min="0" step="0.01" [value]="monthlySalary()" (input)="onSalaryInput($event)" placeholder="e.g. 3000" />
            </div>
          </div>

          <div class="row">
            <div class="form-group">
              <label class="label" for="days">Working days / month</label>
              <input id="days" class="input" type="number" min="1" step="1" [value]="workingDaysPerMonth()" (input)="onDaysInput($event)" />
            </div>
            <div class="form-group">
              <label class="label" for="hours">Working hours / day</label>
              <input id="hours" class="input" type="number" min="1" step="0.5" [value]="workingHoursPerDay()" (input)="onHoursInput($event)" />
            </div>
          </div>

          <div class="actions">
            <button class="btn primary" (click)="completeSetup()" [disabled]="!canContinue()">Continue</button>
          </div>
        </div>
      </section>
    } @else {
      <section class="grid">
        <div class="card form-card">
          <h2 class="card-title">Idle time</h2>
          <div class="form-group">
            <label class="label" for="activity-desc">Description</label>
            <input id="activity-desc" class="input" type="text" [value]="currentDescription()" (input)="onDescInput($event)" placeholder="Idle" />
          </div>
          <div class="form-group">
            <label class="label">Duration</label>
            <input aria-label="Idle duration" class="input time-input" inputmode="numeric" pattern="[0-9:]*" [value]="formattedIdle()" (input)="onIdleTextInput($event)" placeholder="HH:MM:SS" />
            <div class="quick-actions">
              <button class="btn chip" (click)="addIdleSeconds(60)">+1m</button>
              <button class="btn chip" (click)="addIdleSeconds(300)">+5m</button>
              <button class="btn chip" (click)="addIdleSeconds(900)">+15m</button>
              <button class="btn chip" (click)="addIdleSeconds(3600)">+1h</button>
              <button class="btn chip" (click)="clearIdle()">Clear</button>
            </div>
          </div>
          <div class="actions">
            <button class="btn primary" (click)="addActivity()" [disabled]="idleTotalSeconds()===0">Add activity</button>
          </div>
          <div class="actions">
            <button class="btn" (click)="backToSetup()">Back to setup</button>
          </div>
        </div>

        <div class="card results-card">
          <h2 class="card-title">Results</h2>
          <ul class="stats">
            <li class="stat"><span class="stat-label">Per hour</span><span class="stat-value">{{ (earningsPerSecond() * 3600) | currency:'MYR':'symbol':'1.2-2' }}</span></li>
            <li class="stat"><span class="stat-label">Per minute</span><span class="stat-value">{{ (earningsPerSecond() * 60) | currency:'MYR':'symbol':'1.2-2' }}</span></li>
            <li class="stat"><span class="stat-label">Per second</span><span class="stat-value">{{ earningsPerSecond() | currency:'MYR':'symbol':'1.4-4' }}</span></li>
          </ul>
          <div class="highlight">
            <div class="highlight-label">Idle earnings</div>
            <div class="highlight-value">{{ totalIdleEarnings() | currency:'MYR':'symbol':'1.2-2' }}</div>
          </div>
          @if (activities().length === 1) {
            <p class="summary">Today you have earned {{ totalIdleEarnings() | currency:'MYR':'symbol':'1.2-2' }} with {{ activities()[0].description }} {{ humanizeSeconds(totalIdleSecondsFromActivities()) }}.</p>
          } @else if (activities().length === 2) {
            <p class="summary">Today you have earned {{ totalIdleEarnings() | currency:'MYR':'symbol':'1.2-2' }} with {{ activities()[0].description }} and {{ activities()[1].description }} (total {{ humanizeSeconds(totalIdleSecondsFromActivities()) }}).</p>
          } @else {
            <p class="summary">Today you have earned {{ totalIdleEarnings() | currency:'MYR':'symbol':'1.2-2' }} across {{ activities().length }} activities (total {{ humanizeSeconds(totalIdleSecondsFromActivities()) }}).</p>
          }

          <div class="activity-list">
            @for (a of activities(); let i = $index; track i) {
              <div class="activity-row">
                <div class="activity-desc">{{ a.description }}</div>
                <div class="activity-time">{{ formatSeconds(a.seconds) }}</div>
                <div class="activity-value">{{ (earningsPerSecond() * a.seconds) | currency:'MYR':'symbol':'1.2-2' }}</div>
                <button class="btn chip danger" aria-label="Remove" (click)="removeActivity(i)">Remove</button>
              </div>
            }
            @if (activities().length === 0) {
              <div class="activity-empty">No activities yet. Add one on the left.</div>
            }
          </div>
          @if (activities().length > 0) {
            <div class="actions">
              <button class="btn" (click)="clearActivities()">Clear all</button>
            </div>
          }
        </div>
      </section>
    }
  </div>
</main>
